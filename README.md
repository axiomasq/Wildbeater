## Wildbeater — CLI для парсинга и классификации фото (Wildberries)

Wildbeater — это CLI-тулза для Wildberries, которая умеет:
- скачивать изображения по поисковому запросу (парсинг каталога WB);
- классифицировать изображения людей с помощью модели Ultralytics (раскладывание по папкам классов);
- извлекать изображения, содержащие фиолетовые области (детектор цвета).

Инструмент ориентирован на автоматизацию выгрузки и предобработки данных изображений.

### Требования
- Python 3.12+
- Windows/Linux/macOS

### Установка (uv)
Рекомендуемый способ — через `uv` (используется pyproject):

1) Синхронизировать окружение
```
uv sync
```

2) Проверить наличие CLI
```
uv run wildbeater --help
```

Альтернатива (editable установка в текущем venv):
```
uv pip install -e .
wildbeater --help
```

### Обновление после изменения кода
- Если установлен в editable: ничего делать не нужно, изменения подхватываются сразу.
- Если обычная установка:
```
uv pip install -U .
# или принудительно
uv pip install --force-reinstall .
```

### Модель классификации
По умолчанию CLI пытается использовать модель по пути `Model/yolov11sbest-cls.pt` или встроенную в пакет `wildbeater/models/yolov11sbest-cls.pt` (если она упакована в пакетные данные). Можно указать собственный путь флагом `--model`.

### Использование

Общая помощь:
```
wildbeater --help
```

Сабкоманды:

1) Парсинг изображений с Wildberries
```
wildbeater parse -q "купальник" -p 5 -o RawData
```
Аргументы:
- `-q, --query` — поисковый запрос (обязателен)
- `-p, --pages` — число страниц для сканирования (по умолчанию 5)
- `-o, --out-dir` — директория для сохранения JPG (по умолчанию `RawData`)
- `--timeout` — таймаут HTTP-запросов (сек)
- `--no-skip-existing` — не пропускать уже скачанные файлы

2) Классификация изображений
```
wildbeater classify -i RawData -o classify_out --copy
```
Аргументы:
- `-m, --model` — путь к модели (по умолчанию `Model/yolov11sbest-cls.pt` или встроенная)
- `-i, --input-dir` — входная директория с изображениями (по умолчанию `RawData`)
- `-o, --out-dir` — директория для разложенных по классам изображений (по умолчанию `classify_out`)
- `-b, --batch-size` — размер батча (по умолчанию 50)
- `-d, --device` — `auto|cpu|cuda` (по умолчанию `auto`)
- `--pattern` — маска файлов (по умолчанию `*.jpg`)
- `--move` / `--copy` — перемещать или копировать файлы (по умолчанию перемещение)
- `--verbose` — подробный вывод из модели

3) Извлечение изображений с фиолетовыми областями
```
wildbeater extract-purple -i RawData -o purple --action move
```
Аргументы:
- `-i, --input-dir` — входная директория (по умолчанию `RawData`)
- `-o, --out-dir` — директория назначения для copy/move
- `--pattern` — маска файлов (по умолчанию `*.jpg`)
- `--hsv-threshold` — порог доли фиолетовых пикселей (по умолчанию 0.1)
- `--min-area` — минимальная площадь контура (по умолчанию 100)
- `--action` — `copy|move|list` (по умолчанию `copy`)

### Особенности парсинга Wildberries (важно)
Парсер использует логику определения «бакетов» (хостов) для получения метаданных и изображений. На Wildberries эти бакеты реализованы «нестандартно», и стабильного/официального способа автоматически обнаруживать новые бакеты нет. Поэтому проект может перестать работать через несколько месяцев, если WB поменяет схему. В таком случае потребуется вручную обновить константы `vol_host_v2` и `vol_feedback_host` в файле `ParserModule/funcs.py`.

